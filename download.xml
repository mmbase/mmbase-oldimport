<project name="download">
  <!-- =================================================================== -->
  <!-- Various targets for automated downloads                             -->
  <!-- =================================================================== -->
  <target name="unzipdownloadzip" if="download.zip.present"
          unless="download.dir.present">
    <unzip src="${download.zip}" dest="${download.dir}" overwrite="false" />
  </target>

  <target name="download.init.get" depends="proxyflags">

    <available property="download.zip.present" file="${download.zip}" />
    <available property="download.dir.present" file="${download.dir}" />

    <antcall target="unzipdownloadzip" />
    <echo message="Making ${download.dir}" />
    <!-- Init actions -->
    <mkdir dir="${download.dir}"/>
    <mkdir dir="${expand.dir}"/>
  </target>

  <target name="proxyflags" depends="init">
    <!-- check proxy parameters. -->
    <condition property="useproxy">
      <equals arg1="${proxy.use}" arg2="on" />
    </condition>
  </target>

  <target name="setproxy"  if="useproxy">
    <taskdef name="setproxy"
      classname="org.apache.tools.ant.taskdefs.optional.net.SetProxy" />
    <setproxy proxyhost="${proxy.host}" proxyport="${proxy.port}"/>
    <echo message="Using ${proxy.host}:${proxy.port} to download ${sourcefile}"/>
  </target>

  <target name="testexist">
    <echo message="Testing  for ${destfile}"/>
    <available file="${destfile}" property="exist"/>
  </target>

  <target name="testexpanded">
    <echo message="Testing for ${expandedfile}"/>
    <available file="${expandedfile}" property="expanded"/>
  </target>

  <target name="download" unless="exist" depends="setproxy,testexist,download.init.get">
    <!-- Download the package -->
    <get src="${sourcefile}" dest="${destfile}" verbose="on" />
  </target>

  <target name="downloadgz" unless="expanded" depends="download,testexpanded">
    <!-- Extract the package -->
    <gunzip src="${destfile}" dest="${download.dir}/file.tar"/>
    <untar src="${download.dir}/file.tar" dest="${expand.dir}"/>
    <delete file="${download.dir}/file.tar"/>
  </target>

  <target name="downloadbz2" unless="expanded" depends="download,testexpanded">
    <!-- Extract the package -->
    <mkdir dir="${destdir}" />
    <bunzip2 src="${destfile}" dest="${download.dir}/file.tar"/>
    <untar src="${download.dir}/file.tar" dest="${destdir}"/>
    <delete file="${download.dir}/file.tar"/>
  </target>

  <target name="downloadzip" unless="expanded" depends="download,testexpanded">
    <!-- Extract the package -->
    <mkdir dir="${destdir}" />
    <unzip src="${destfile}" dest="${destdir}"/>
  </target>

  <!-- =================================================================== -->
  <!-- Clean the download directory                                        -->
  <!-- =================================================================== -->
  <target name="clean.download" description="Clean the download directory">
    <delete dir="${download.dir}"/>
  </target>


  <!-- =================================================================== -->
  <!-- Clean the expand directory                                          -->
  <!-- =================================================================== -->
  <target name="clean.expand" description="Clean the expand directory">
    <delete dir="${expand.dir}"/>
    <delete file="${download.dir}/file.tar" />
  </target>
</project>
