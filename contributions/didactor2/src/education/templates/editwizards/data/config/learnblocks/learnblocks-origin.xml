<?xml version="1.0"?>
<!DOCTYPE wizard-schema PUBLIC "-//MMBase/DTD editwizard 1.0//EN" "http://www.mmbase.org/dtd/wizard-schema_1_0.dtd"
[
  <!ENTITY extra_loads SYSTEM "extra_loads.xml">
  <!ENTITY extra_steps SYSTEM "extra_steps.xml">
  <!ENTITY extra_schemas SYSTEM "extra_schemas.xml">
  <!ENTITY extra_lists SYSTEM "extra_lists.xml">
]>
<wizard-schema id="empty">
  <title xml:lang="nl">Leerblok Editor</title>
  <title xml:lang="en">Learnblock Editor</title>

  <action type="create">
    <object type="learnblocks">
      <relation destination="$origin" role="posrel" createdir="source"/>
      <field name="showtitle">1</field>
    </object>
  </action>

  <action type="load">
    <relation destination="learnobjects" role="posrel" />
    <relation destination="mmevents" role="related" />
    <relation destination="images" role="sizerel" />
    <relation destination="paragraphs" role="posrel">
      <object>
        <relation destination="attachments" role="posrel" />
        <relation destination="images" role="pos2rel" />
        <relation destination="urls" role="posrel" />
      </object>
    </relation>
    <relation destination="audiotapes" role="posrel" />
    <relation destination="videotapes" role="posrel" />
    <relation destination="attachments" role="posrel" />
    <relation destination="urls" role="posrel" />
    <relation destination="feedback" role="descriptionrel" /> 
    &extra_loads;
  </action>

  <action type="delete" />

  <lists>
    <optionlist include="config/option_list/images_position.xml" />
    <optionlist include="config/option_list/boolean.xml" />
    <optionlist include="config/option_list/layout.xml" />
    <optionlist include="config/option_list/imagelayout.xml" />
  </lists>

  <steps>
    <step form-schema="step1" />
    <step form-schema="step2" />
    &extra_steps;
  </steps>

  <form-schema id="step1">
    <title xml:lang="nl">Leerblok invoeren</title>
    <title xml:lang="en">Enter learnblock</title>
    <field name="name" >
      <prompt xml:lang="nl">Leerblok titel</prompt>
      <prompt xml:lang="en">Learnblock Name</prompt>
    </field>

    <field name="showtitle" ftype="enum">
      <prompt xml:lang="nl">Titel laten zien</prompt>
      <prompt xml:lang="en">Show title</prompt>
      <optionlist select="boolean" />
    </field>

    <field name="intro" ftype="${wizards.pages.text.ftype}" dtminlength="0">
      <prompt xml:lang="nl">Tekst</prompt>
      <prompt xml:lang="en">Text</prompt>
    </field>

    <field name="layout" ftype="enum">
      <prompt xml:lang="nl">Layout</prompt>
      <prompt xml:lang="en">Layout</prompt>
      <optionlist select="layout" />
    </field>
    <field name="imagelayout" ftype="enum">
      <prompt xml:lang="nl">Layout afbeeldingen</prompt>
      <prompt xml:lang="en">Layout images</prompt>
      <optionlist select="imagelayout" />
    </field>

    <list role="sizerel" extends="config/image/sizedimages.xml" />
    <list role="posrel" extends="config/attachment/attachments-posrel.xml" />
    <list role="posrel" extends="config/audiotape/audiotapes-posrel.xml" />
    <list role="posrel" extends="config/videotape/videotapes-posrel.xml" />

    <list destination="urls" role="posrel" extends="config/url/urls-posrel.xml" />

    <!--
      We want to list learnobjects, but there are objects that extend learnobject that we want to show.
      if you do the following:
        <list destination="learnobjects" role="posrel">
      then you can't show the 'tests' or 'pages' items, since the editwizard engine will simply discard
      them since they don't have the 'learnobject' type; it generates:
        <list destination="learnobjects" fdatapath="relation[@role='posrel' and object/@type='learnobjects']" ...

      Note: the 'wizard.xsl' file depends on the title being "Bijbehorende leerobjecten" in order to
      select the correct JSP for finding learnobjects. DO NOT CHANGE THIS TITLE!
    -->
    <list minoccurs="0" maxoccurs="*" ordertype="number" orderby="field[@name='pos']"
          fdatapath="relation[@role='posrel' and ( object/@type='learnblocks' or object/@type='flashpages' or object/@type='tests' or object/@type='pages' or object/@type='htmlpages')]"
          searchdir="destination">
      <title xml:lang="nl">Bijbehorende leerobjecten</title>
      <title xml:lang="en">Related learnobjects</title>
      <item>
        <field name="name" ftype="data">
          <prompt xml:lang="nl">Naam</prompt>
          <prompt xml:lang="en">Name</prompt>
          <description xml:lang="nl">Naam van het leerobject</description>
          <description xml:lang="en">Name of the learnobject</description>
        </field>
        <field fdatapath="field[@name=&apos;pos&apos;]" ftype="line">
          <prompt xml:lang="nl">Positie</prompt>
          <prompt xml:lang="en">Position</prompt>
        </field>
      </item>

      <action type="create">
        <relation role="posrel" destinationtype="learnobjects">
          <field name="pos">{sum(//relation[@role='posrel' and @lastitem='true']/field[@name='pos'])+{$pos}}</field>
        </relation>
      </action>

      <command name="startwizard" inline="true" wizardname="config/learnblocks/learnblocks" objectnumber="new">
        <prompt xml:lang="nl">Nieuw leerblok</prompt>
        <prompt xml:lang="en">New learnblock</prompt>       
      </command>

      <command name="startwizard" inline="true" wizardname="config/pages/pages" objectnumber="new">
        <prompt xml:lang="nl">Nieuwe pagina</prompt>
        <prompt xml:lang="en">New page</prompt>       
      </command>

      <command name="startwizard" inline="true" wizardname="config/flashpages/flashpages" objectnumber="new">
        <prompt xml:lang="nl">Nieuwe flash pagina</prompt>
        <prompt xml:lang="en">New flash page</prompt>
      </command>

      <command name="startwizard" inline="true" wizardname="config/tests/tests" objectnumber="new">
        <prompt xml:lang="nl">Nieuwe toets</prompt>
        <prompt xml:lang="en">New test</prompt>       
      </command>

      <command name="startwizard" inline="true" wizardname="config/htmlpages/htmlpages" objectnumber="new">
        <prompt xml:lang="nl">Nieuwe htmlpagina</prompt>
        <prompt xml:lang="en">New htmlpage</prompt>      
      </command>

      <command name="search" nodepath="learnobjects,learnblocks" fields="learnobjects.name,learnblocks.intro" age="-1" orderby="learnobjects.number,learnblocks.number" directions="down,down" >
        <prompt xml:lang="nl">Zoeken naar leerobjecten</prompt>
        <prompt xml:lang="en">Search for learnobjects</prompt>
        <search-filter>
          <name xml:lang="nl">Titel bevat</name>
          <name xml:lang="en">Name contains</name>
          <search-fields>learnobjects.name</search-fields>
        </search-filter>
        <search-filter>
          <name xml:lang="nl">Tekst bevat</name>
          <name xml:lang="en">Text contains</name>
          <search-fields>learnblocks.intro</search-fields>
        </search-filter>
      </command>
    </list>

    <list role="descriptionrel" extends="config/feedback/feedback-described.xml" /> 
    <list role="related" extends="config/online/online-list.xml" />
    &extra_lists;
  </form-schema>

  <form-schema id="step2">
    <title xml:lang="nl">Alineas invoeren</title>
    <title xml:lang="en">Enter paragraphs</title>
    <field name="name" ftype="data"/>
    <field name="showtitle" ftype="enum">
      <prompt xml:lang="nl">Titel laten zien</prompt>
      <prompt xml:lang="en">Show title</prompt>
      <optionlist select="boolean" />
    </field>
    <list extends="config/paragraphs/add_paragraphs_posrel.xml"/>
  </form-schema>

  &extra_schemas;
</wizard-schema>
