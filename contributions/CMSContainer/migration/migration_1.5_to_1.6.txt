Migration document:

Part: core
From version: 1.5
To version: 1.6


Execute the following steps below in the given order:

Name: Add publishdate, expiredate, use_expirydate and m_status column to urls, images and attachments
Goal: Add publishdate, expiredate, use_expirydate and m_status column to urls, images and attachments
Type:  sql-script
--- Start script ---
ALTER TABLE mm_attachments ADD column (publishdate datetime default NULL,expiredate datetime default NULL,use_expirydate bit(1) NOT NULL,m_status text);
ALTER TABLE mm_images ADD column (publishdate datetime default NULL,expiredate datetime default NULL,use_expirydate bit(1) NOT NULL,m_status text);
ALTER TABLE mm_urls ADD column (publishdate datetime default NULL,expiredate datetime default NULL,use_expirydate bit(1) NOT NULL,m_status text);

ALTER TABLE live_attachments ADD column (publishdate datetime default NULL,expiredate datetime default NULL,use_expirydate bit(1) NOT NULL,m_status text);
ALTER TABLE live_images ADD column (publishdate datetime default NULL,expiredate datetime default NULL,use_expirydate bit(1) NOT NULL,m_status text);
ALTER TABLE live_urls ADD column (publishdate datetime default NULL,expiredate datetime default NULL,use_expirydate bit(1) NOT NULL,m_status text);

--- End script ---
Exceptions/errors/other problems and what to do:
*
*
*

Name: Add nodetype column to workflowitem
Goal: Add nodetype column to workflowitem
Type:  sql-script
--- Start script ---
ALTER TABLE mm_workflowitem ADD column nodetype varchar(64) default NULL;

--- End script ---
Exceptions/errors/other problems and what to do:
*
*
*


Name: Add title and description column to urls / images
Goal: Asset improvements
Type:  sql-script
--- Start script ---
ALTER TABLE mm_urls ADD column title text NULL;
ALTER TABLE mm_urls MODIFY description text NULL;
ALTER TABLE mm_images MODIFY title text NULL;

ALTER TABLE live_images MODIFY title text NULL;
ALTER TABLE live_urls ADD column title text NULL;
ALTER TABLE live_urls MODIFY description text NULL;

update mm_urls set title=name;
update live_urls set title=name;
--- End script ---
Exceptions/errors/other problems and what to do:
*
*
*


Name: Migration from images/attachments/urls to assetelement table
Goal:  migrate all images/attachments/URLs to new assets table
Type:  sql-script
--- Start script ---
* First start CMSC 1.6 for the first time (it needs to create the assets tables!)
* Wait for finishing startup (editors should work)
* Stop CMSC 1.6
* Execute the following script on database:
INSERT INTO mm_assetelement select number,otype,owner,creationdate,lastmodifieddate,publishdate,expiredate,lastmodifier,creator,use_expirydate,title,description,m_status from mm_urls;
INSERT INTO mm_assetelement select number,otype,owner,creationdate,lastmodifieddate,publishdate,expiredate,lastmodifier,creator,use_expirydate,title,description,m_status from mm_attachments;
INSERT INTO mm_assetelement select number,otype,owner,creationdate,lastmodifieddate,publishdate,expiredate,lastmodifier,creator,use_expirydate,title,description,m_status from mm_images;

INSERT INTO live_assetelement select number,otype,owner,creationdate,lastmodifieddate,publishdate,expiredate,lastmodifier,creator,use_expirydate,title,description,m_status from live_urls;
INSERT INTO live_assetelement select number,otype,owner,creationdate,lastmodifieddate,publishdate,expiredate,lastmodifier,creator,use_expirydate,title,description,m_status from live_attachments;
INSERT INTO live_assetelement select number,otype,owner,creationdate,lastmodifieddate,publishdate,expiredate,lastmodifier,creator,use_expirydate,title,description,m_status from live_images;
--- End script ---
*
*
*


Name: Move existing assets to a existing content channel (only on staging)
Goal:  make all existing assets usable and searchable.
Type:  run JSP file as admin user
--- Start ---
- Run staging/editors/maintenance/create-relations-asset-channel.jsp
  and enter the nodenumber of the channel in the repository where the unattached images should go to.
--- End ---
*
*
*
