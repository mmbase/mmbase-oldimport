<?xml version="1.0"?>
<project name="MMBase Richtext" default="jar" basedir=".">
  <property name="project.name"   value="richtext" />
  <property name="java.source.version" value="1.5" />
  <import file="../buildbase-include.xml" />
  <property name="svnant"         location="svnant.jar" />
  <property name="svnjavahl"      location="svnjavahl.jar" />
  <property name="svnclient"      location="svnClientAdapter.jar" />
  <property name="javasvn"      location="javasvn.jar" />

  <target name="package" depends="kupu,buildbase.package">
  </target>

  <target name="svn-task">
    <!-- nice nice, but I can't get it working. ant sucks, and the svn task too -->
    <ant target="download" dir="${source.dir}">
      <property name="sourcefile" value="http://www.mmbase.org/download/jars/svnant.jar" />
      <property name="destfile"   value="${svnant}" />
    </ant>
    <ant target="download" dir="${source.dir}">
      <property name="sourcefile" value="http://www.mmbase.org/download/jars/svnjavahl.jar" />
      <property name="destfile"   value="${svnjavahl}" />
    </ant>
    <ant target="download" dir="${source.dir}">
      <property name="sourcefile" value="http://www.mmbase.org/download/jars/svnClientAdapter.jar" />
      <property name="destfile"   value="${svnclient}" />
    </ant>

    <taskdef name="svn" classname="org.tigris.subversion.svnant.SvnTask">
      <classpath>
        <pathelement location="${svnant}"/>
        <pathelement location="${svnjavahl}"/>
        <pathelement location="${svnclient}"/>
        <pathelement location="${javasvn}"/>
      </classpath>
    </taskdef>

  </target>

  <target name="clean" depends="buildbase.clean">
    <mkdir dir="mmbase/kupu" />
    <exec executable="make" dir="mmbase/kupu">
      <arg line="clean" />
    </exec>
    <!-- I HATE ANT , I just don't want errors if the directory happens to be non existings -->
    <mkdir dir="mmbase/kupu/mmbase" />
    <exec executable="make" dir="mmbase/kupu/mmbase">
      <arg line="clean" />
    </exec>
  </target>

  <target name="template.include">
    <zipfileset dir="${project.source.dir}" prefix="${zip.name}/web-app">
      <patternset id="web-app.package.files" >
        <include name="mmbase/style/**" />
        <include name="mmbase/kupu/mmbase/**/*.jspx" />
        <include name="mmbase/kupu/mmbase/**/*.css" />
        <include name="mmbase/kupu/mmbase/**/*.js" />
        <include name="mmbase/kupu/mmbase/icons/**" />
        <include name="mmbase/kupu/common/**" />
        <include name="templates/**" />
      </patternset>
    </zipfileset>
  </target>

  <target name="install.config" depends="init" if="config.available">
    <copy todir="${mmbase.config}" preservelastmodified="true">
      <fileset dir="${project.config.dir}" >
        <include name="applications/**" />
        <exclude name="**/INDEX" />
      </fileset>
    </copy>
  </target>



  <target name="kupu">
    <!--
    <svn javahl="false">
      <checkout url="http://codespeak.net/svn/kupu/trunk/kupu/" />
    </svn>

result:kupu:
      [svn] Using javasvn
Svn : Checking out a working copy from a repository :
checkout -r HEAD http://codespeak.net/svn/kupu/trunk/kupu/
HTTP 301 MOVED PERMANENTLY: http://codespeak.net/svn/kupu/trunk/kupu

Beats me: it's impossible.

To hell with it.
This is a _whole lot_ easier.
    -->
    <mkdir dir="mmbase/kupu" />
    <exec executable="svn" dir="mmbase">
      <arg line="co  http://codespeak.net/svn/kupu/trunk/kupu" />
    </exec>
    <exec executable="make" dir="mmbase/kupu">
      <arg line="kupu-i18n.jar" />
    </exec>
    <exec executable="make" dir="mmbase/kupu/mmbase" />
    <exec executable="make" dir="mmbase/kupu/mmbase">
      <arg line="mmbase-kupu-i18n.jar" />
    </exec>
    <copy todir="${project.build.dir}" preservelastmodified="true" flatten="true">
      <fileset dir="mmbase/kupu">
        <include name="**/*.jar" />
      </fileset>
    </copy>
  </target>
</project>
